' Gambas class file

Private rstResultado As Result
Private sFiltro As String = "%"
Private sEstado As String = "%"

Public Sub btnSalir2_Click()
  
  Me.Close()
  MenuPrincipal.Show()
  
End

Public Sub Form_Open()
  ' Cargamos el ResultSet con los filtros
  
  rstResultado = cUsuarios.GetUsers(sFiltro, sEstado)
  ' obtenemos los registro para pintar el grid
  cUsuarios.GetGrid(grvUsuarios, rstResultado)
  
  'picDuplicado.Picture = gConst.picDuplicado
  ComboRoles()
  
End

Public Sub ComboRoles()
  
  cmbRol.Clear()
  
  rstResultado = cRoles.GetAllRoles()
  
  rstResultado.MoveFirst
  
  Do While rstResultado.Available
    
    cmbRol.Add(rstResultado!NOMBRE, rstResultado!ID_ROL)
    
    rstResultado.MoveNext  
  Loop
  
End

Public Sub txtFiltroUsuarios_KeyRelease()
  
  sFiltro = txtFiltroUsuarios.Text
  
  rstResultado = cUsuarios.GetUsers(sFiltro, sEstado)
  ' obtenemos los registro para pintar el grid
  cUsuarios.GetGrid(grvUsuarios, rstResultado)
  'TODO: No funciona la forma de filtrar el Grid pasado por referencia
  grvUsuarios.Clear
  rstResultado = Null
  
End
