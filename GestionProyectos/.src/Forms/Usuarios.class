' Gambas class file

Private rstResultado As Result
Private sFiltro As String = "%"
Private sEstado As String = "%"

Public Sub btnSalir2_Click()
  
  Me.Close()
  MenuPrincipal.Show()
  
End

Public Sub Form_Open()
  ' Cargamos el ResultSet con los filtros
  
  rstResultado = cUsuarios.GetUsers(sFiltro, sEstado)
  ' obtenemos los registro para pintar el grid  
  grvUsuarios = cUsuarios.GetGrid(grvUsuarios, rstResultado)
  
  ComboRoles()
  
End

Public Sub ComboRoles()
  
  cmbRol.Clear()
  
  rstResultado = cRoles.GetAllRoles()
  
  rstResultado.MoveFirst
  
  Do While rstResultado.Available
    
    cmbRol.Add(rstResultado!NOMBRE, rstResultado!ID_ROL)
    
    rstResultado.MoveNext  
  Loop
  
End

Public Sub txtFiltroUsuarios_KeyRelease()
  
  sFiltro = txtFiltroUsuarios.Text
  
  rstResultado = cUsuarios.GetUsers(sFiltro, sEstado)
  
  grvUsuarios = cUsuarios.GetGrid(grvUsuarios, rstResultado)
  
End

Public Sub Recargar()
  
  Dim n As Integer = 0
  
  For n = 0 To grvUsuarios.Columns.Count - 1
    grvUsuarios.Columns[n].title = rstResultado.Fields[n].name 'Para el ejemplo ponemos como cabecera el nombre del campo 
    grvUsuarios.Columns[n].Expand = True 'las columnas de ancho variable para que se ajusten al ancho disponible
  Next
  
  grvUsuarios.columns.count = rstResultado.fields.count  'Tantas filas y columnas como registros y campos
  grvUsuarios.Rows.Count = rstResultado.Count
  
End 
