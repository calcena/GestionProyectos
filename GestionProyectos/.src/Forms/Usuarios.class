' Gambas class file

Private rstResultado As Result
Private sFiltro As String = "%"
Private sEstado As String = "%"

Public Sub btnSalir2_Click()
  
  Me.Close()
  MenuPrincipal.Show()
  
End

Public Sub Form_Open()
  ' Cargamos el ResultSet con los filtros
  
  CargarGrid()
  
  ComboRoles()
  
End

Public Sub ComboRoles()
  
  cmbRol.Clear()
  
  rstResultado = cRoles.GetAllRoles()
  
  rstResultado.MoveFirst
  
  Do While rstResultado.Available
    
    cmbRol.Add(rstResultado!NOMBRE, rstResultado!ID_ROL)
    
    rstResultado.MoveNext  
  Loop
  
End

Public Sub txtFiltroUsuarios_KeyRelease()
  
  sFiltro = txtFiltroUsuarios.Text
  CargarGrid()
  
End

Public Sub GetRows() 
  
  Dim resultado As String 
  
  resultado = CStr(rstResultado.Count)
  lblRegistros.Text = "Registros: " & resultado 
  
End

Public Sub CargarGrid()  
  
  rstResultado = cUsuarios.GetUsers(sFiltro, sEstado)
  ' obtenemos los registro para pintar el grid  
  grvUsuarios = cUsuarios.GetGrid(grvUsuarios, rstResultado)
  
  GetRows()
  
End

Public Sub btnAdd_Click()
  
  ' se hacen visible los botones de Aceptar y Cancelar acci√≥n
  btnAceptar.Visible = True
  btnCancelar.visible = True
  btnAdd.Enabled = False
  txtCodigo.Text = gUtils.GetCodigo("USU")
  
End

Public Sub btnAceptar_Click()
  
  If Len(Trim(txtNombre.text)) = 0 Or Len(Trim(txtApellido1.text)) = 0 Or Len(Trim(txtApellido2.text)) = 0 Or Len(Trim(txtPass.text)) = 0 Or Len(Trim(txtPass2.text)) = 0 Then 
    'nombre
    If Len(Trim(txtNombre.text)) = 0 Then 
      txtNombre.Background = Color.Red
    Else
      txtNombre.Background = Color.white
    End If 
    'apellido1
    If Len(Trim(txtApellido1.text)) = 0 Then 
      txtApellido1.Background = Color.Red
    Else
      txtApellido1.Background = Color.white
    End If
    'apellido2
    If Len(Trim(txtApellido2.text)) = 0 Then 
      txtApellido2.Background = Color.Red
    Else
      txtApellido2.Background = Color.White
    End If
    'password
    If Len(Trim(txtPass.text)) = 0 Then 
      txtPass.Background = Color.Red
    Else
      txtPass.Background = Color.white
    End If
    'repetir password
    If Len(Trim(txtPass2.text)) = 0 Then 
      txtPass2.Background = Color.Red
    Else
      txtPass2.Background = Color.white      
    End If
    ' Aviso por pantalla al usuario
    Message.Warning("Debe cumplimentar los datos marcados en rojo")
  Else 
    
    btnLimpiar_Click()
    btnAceptar.visible = False
    btnCancelar.visible = False
    
  Endif
  
End

Public Sub btnLimpiar_Click()
  
End
